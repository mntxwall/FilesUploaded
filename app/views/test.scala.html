@()
<!DOCTYPE html>
<html lang="en">
    <head>
        @* Here's where we render the page title `String`. *@
        <title>DropZoneTest</title>
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/dropzone.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/bulma.min.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.versioned("images/favicon.png")">
        <script src="@routes.Assets.versioned("javascripts/main.js")" type="text/javascript"></script>

        <meta charset="utf-8">

    </head>
    <body>
        @* And here's where we render the `Html` object containing
        * the page content. *@
        <form
        class="dropzone field"
        id="my-awesome-dropzone"  method="post" enctype="multipart/form-data">
        </form>

        <form method="post" action="/zip" id="form-zip" class="field">
            <textarea class="textarea" placeholder="信息输入" rows="5" name="ziptext" id="zip-text"></textarea>
            <input type="hidden" value="" id="zip-files-name" name="zipfiles">
            <button type="button" class="button is-info" id="btn-transfer">开始传输</button>
        </form>

        <script src="@routes.Assets.versioned("javascripts/dropzone.js")" type="text/javascript"></script>

        <script type="text/javascript">

                Dropzone.options.myAwesomeDropzone = {
                    dictDefaultMessage: "点击上传",
                    url: "/upload",
                    addRemoveLinks: true,
                    dictRemoveFile: "删除文件",
                    acceptedFiles:"image/*",
                    init: function() {
                        this.on("success", function(file) {
                            var response = JSON.parse(file.xhr.responseText);

                            /*
                            * Check if the uploads value not null
                            * */
                            var uploadedFiles = cookies.getCookie("uploads");

                            if (uploadedFiles === "") {
                                console.log("empty");
                                cookies.setCookie("uploads", response.file, 10);
                            }
                            else {
                                cookies.setCookie("uploads", uploadedFiles + "," + response.file, 10);
                            }

                            //setCookie("uploads", response.file, 10);
                            //console.log();
                            console.log(response);
                            console.log(cookies.getCookie("uploads"));

                        });
                    }
                }

                document.getElementById("btn-transfer").addEventListener('click', function (evt) {

                    var formFiles = cookies.getCookie("uploads");

                    document.getElementById("zip-files-name").value = formFiles;

                    //console.log();

                    cookies.setCookie("uploads", "", 0);

                    document.getElementById("form-zip").submit();
                })
        </script>
    </body>
</html>